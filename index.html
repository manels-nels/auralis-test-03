<!DOCTYPE html>
<html>
<head>
    <title>AURALIS AR Experience (Info on Hover+Click)</title> <!-- Titre mis à jour -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="AURALIS AR Experience with info button appearing on logo hover."> <!-- Description mise à jour -->

    <!-- A-Frame Core -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <!-- AR.js for A-Frame -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.0/aframe/build/aframe-ar.min.js"></script>

    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; } /* Ajout font-family */
        .arjs-loader { height: 100%; width: 100%; position: absolute; top: 0; left: 0; background-color: rgba(0, 0, 0, 0.8); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .arjs-loader div { text-align: center; font-size: 1.25em; color: white; }
        #wechat-notice { position: absolute; top: 10px; left: 10px; right: 10px; padding: 10px; background: rgba(0,0,0,0.7); color: white; z-index: 10001; /* Au-dessus boutons */ font-size: 14px; text-align: center; border-radius: 5px; }

        #sound-toggle-button {
            position: absolute; bottom: 20px; left: 20px; z-index: 10000; /* Sous notice */
            padding: 10px 15px; font-size: 1em; color: #333;
            background-color: rgba(255, 255, 255, 0.8); border: 1px solid #ccc;
            border-radius: 5px; cursor: pointer; display: none;
        }
        #sound-toggle-button:hover { background-color: rgba(255, 255, 255, 1); }

        /* --- NOUVEAU : Style pour le bouton d'information du logo --- */
        #logo-info-button {
            position: absolute;
            bottom: 20px;
            right: 20px; /* Positionné en bas à droite */
            z-index: 10000; /* Même niveau que bouton son */
            padding: 10px 15px;
            font-size: 1em;
            font-family: sans-serif;
            color: #333;
            background-color: rgba(220, 220, 255, 0.85); /* Couleur distincte (bleu clair) */
            border: 1px solid #aaa;
            border-radius: 5px;
            cursor: pointer;
            display: none; /* Initialement caché */
        }
         #logo-info-button:hover {
             background-color: rgba(220, 220, 255, 1);
        }
        /* --- Fin Style Bouton Info --- */

         /* --- NOUVEAU : Style pour le texte Pop-up --- */
        #popup-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10002; /* Au-dessus de tout */
            background-color: rgba(0, 0, 0, 0.75);
            color: white;
            padding: 20px 30px;
            border-radius: 8px;
            text-align: center;
            font-size: 1.1em;
            display: none; /* Initialement caché */
            cursor: pointer;
            max-width: 80%;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        /* --- Fin Style Pop-up --- */

    </style>
</head>

<body style='margin : 0px; overflow: hidden;'>

    <!-- Message WeChat (inchangé) -->
    <div id="wechat-notice" onclick="this.style.display='none';"><b>Note WeChat:</b> ...</div>

    <!-- Loader AR.js (inchangé) -->
    <div class="arjs-loader" id="arjs-loader-div"><div>Loading AURALIS Experience.....</div></div>

    <!-- Bouton Son (inchangé) -->
    <button id="sound-toggle-button">Play Sound</button>

    <!-- --- NOUVEAU : Bouton pour afficher l'info du logo --- -->
    <button id="logo-info-button">Info</button>
    <!-- --- Fin Bouton Info --- -->

    <!-- --- NOUVEAU : Conteneur pour le texte Pop-up --- -->
    <div id="popup-text"></div>
    <!-- --- Fin Conteneur Pop-up --- -->

    <!-- Scène A-Frame (inchangée) -->
    <a-scene id="ar-scene" embedded arjs='sourceType: webcam; trackingMethod: best; debugUIEnabled: false;' renderer='logarithmicDepthBuffer: true; colorManagement: true;' vr-mode-ui='enabled: false'>
        <!-- Assets (inchangés) -->
        <a-assets timeout="60000">
             <img id="logoImg" src="images/logo.jpg" crossOrigin="anonymous">
             <img id="wangMengImg" src="images/wang_meng.jpg" crossOrigin="anonymous">
             <img id="yuMiaoImg" src="images/yu_miao.jpg" crossOrigin="anonymous">
             <img id="djBackImg" src="images/dj_back.jpg" crossOrigin="anonymous">
             <img id="stageWideImg" src="images/stage_wide.jpg" crossOrigin="anonymous">
             <img id="stageDuoBlueImg" src="images/stage_duo_blue.jpg" crossOrigin="anonymous">
             <img id="stageDuoDarkImg" src="images/stage_duo_dark.jpg" crossOrigin="anonymous">
             <audio id="logoSound" src="audio/your_sound.mp3" preload="auto" crossOrigin="anonymous"></audio>
             <a-asset-item id="jellyfishModel" src="models/meduse.glb" crossOrigin="anonymous"></a-asset-item>
        </a-assets>
        <!-- Conteneur panneaux (inchangé) -->
        <a-entity id="content-container" position="0 1.5 -4.0" rotation="0 0 0" scale="1 1 1"></a-entity>
        <!-- Méduse (inchangée) -->
        <a-gltf-model id="jellyfish" src="#jellyfishModel" position="-1 2 -2" scale="0.3 0.3 0.3" rotation="0 0 0" animation__pos="property: position; from: -1 2 -2; to: 1 1.2 -1.5; dir: alternate; dur: 12000; easing: easeInOutSine; loop: true;" animation__rot="property: rotation; to: 0 360 0; dur: 20000; easing: linear; loop: true;" animation-mixer="clip: *; loop: repeat"></a-gltf-model>
        <!-- Caméra (inchangée) -->
        <a-camera cursor="rayOrigin: mouse; fuse: false;" raycaster="objects: [data-interactive]"></a-camera>
    </a-scene>

    <!-- --- Script pour générer le contenu --- -->
    <script>
        // Configuration, Data (inchangées)
        const PANEL_BASE_WIDTH = 1.8; const PANEL_COLOR = '#1a1a3a'; const PANEL_OPACITY = 0.85; const BG_Z_OFFSET = -0.01; const IMAGE_Z_OFFSET = 0;
        const imagePositions = { 'logoImg': { x: 0, y: 0, z: 0.1 }, 'wangMengImg': { x: -2.2, y: 2, z: -0.1 }, 'yuMiaoImg': { x: 2.2, y: 0.4, z: -0.1 }, 'stageWideImg': { x: 0, y: 2, z: -0.3 }, 'djBackImg': { x: 0, y: -2, z: -0.2 }, 'stageDuoBlueImg': { x: -2.5, y: -0.8, z: 0.2 }, 'stageDuoDarkImg': { x: 2.5, y: -0.8, z: 0.2 }, };
        const contentData = [ { type: 'image', srcId: 'logoImg', originalWidth: 2, originalHeight: 2 }, { type: 'image', srcId: 'wangMengImg', originalWidth: 1, originalHeight: 1.2 }, { type: 'image', srcId: 'yuMiaoImg', originalWidth: 1.5, originalHeight: 1 }, { type: 'image', srcId: 'stageWideImg', originalWidth: 2, originalHeight: 1.1 }, { type: 'image', srcId: 'djBackImg', originalWidth: 1, originalHeight: 1.25 }, { type: 'image', srcId: 'stageDuoBlueImg', originalWidth: 1.8, originalHeight: 1.1 }, { type: 'image', srcId: 'stageDuoDarkImg', originalWidth: 1.8, originalHeight: 1.1 } ];

        // --- Fonction createPanel (MODIFIÉE pour hover sur logo) ---
        function createImagePanel(itemData, position) {
            const container = document.getElementById('content-container');
            if (!container || !itemData || itemData.type !== 'image' || !itemData.srcId) return null;
            const imgElement = document.getElementById(itemData.srcId);
            if (!imgElement || !itemData.originalWidth || !itemData.originalHeight) { console.warn(`Asset/dimensions missing for ${itemData.srcId}`); return null; }

            const entity = document.createElement('a-entity');
            const aspect = itemData.originalWidth / itemData.originalHeight;
            const panelWidth = PANEL_BASE_WIDTH; const panelHeight = panelWidth / aspect;

            // Interaction survol (inchangée mais maintenant utilisée pour le bouton info)
            entity.setAttribute('animation__scaleup', `property: scale; to: 1.1 1.1 1.1; startEvents: mouseenter; dur: 200; easing: easeOutQuad;`);
            entity.setAttribute('animation__scaledown', `property: scale; to: 1 1 1; startEvents: mouseleave; dur: 200; easing: easeInQuad;`);
            entity.setAttribute('data-interactive', ''); // ESSENTIEL pour mouseenter/mouseleave

            // Fond, Image (inchangés)
            const imgBgPlane = document.createElement('a-plane'); imgBgPlane.setAttribute('width', panelWidth * 1.05); imgBgPlane.setAttribute('height', panelHeight * 1.05); imgBgPlane.setAttribute('material', `color: ${PANEL_COLOR}; opacity: ${PANEL_OPACITY}; shader: flat;`); imgBgPlane.setAttribute('position', `0 0 ${BG_Z_OFFSET - 0.005}`); entity.appendChild(imgBgPlane);
            const imgPlane = document.createElement('a-plane'); imgPlane.setAttribute('width', panelWidth); imgPlane.setAttribute('height', panelHeight); imgPlane.setAttribute('material', `src: #${itemData.srcId}; shader: flat; transparent: true;`); imgPlane.setAttribute('position', `0 0 ${IMAGE_Z_OFFSET}`); entity.appendChild(imgPlane);

            // --- MODIFICATION : Gestion Son ET Affichage Bouton Info pour le logo ---
            if (itemData.srcId === 'logoImg') {
                // 1. ID et Son (inchangés par rapport à la version précédente)
                entity.setAttribute('id', 'logo-panel');
                entity.setAttribute('sound', { src: '#logoSound', loop: true, volume: 0.8, positional: true, distanceModel: 'inverse', refDistance: 1, rolloffFactor: 1 });
                console.log(`Added sound component to logo-panel (autoplay disabled).`);

                // 2. Afficher/Cacher le bouton d'info HTML au survol de l'entité A-Frame
                const infoButton = document.getElementById('logo-info-button');
                if (infoButton) {
                    entity.addEventListener('mouseenter', () => {
                        console.log("Mouse entered logo panel, showing info button.");
                        infoButton.style.display = 'block';
                    });
                    entity.addEventListener('mouseleave', () => {
                        console.log("Mouse left logo panel, hiding info button.");
                        infoButton.style.display = 'none';
                        // Optionnel : cacher aussi le popup texte s'il est visible quand on quitte le logo
                        // const popup = document.getElementById('popup-text');
                        // if (popup) popup.style.display = 'none';
                    });
                     console.log(`Added mouseenter/mouseleave listeners to logo-panel for info button.`);
                } else {
                    console.error("Logo info button element not found during panel creation!");
                }
            }
            // --- Fin Modification Logo ---

            entity.setAttribute('position', `${position.x} ${position.y} ${position.z}`);
            container.appendChild(entity);
            return entity;
        }

        // --- Fonction setupManualLayout (inchangée) ---
        function setupManualLayout() { /* ... code identique ... */
             const container = document.getElementById('content-container'); if (!container) { console.error("Could not find #content-container entity."); return; } while (container.firstChild) { container.removeChild(container.firstChild); } contentData.forEach(item => { if (item.type === 'image' && item.srcId && imagePositions[item.srcId]) { const position = imagePositions[item.srcId]; createImagePanel(item, position); } else if (item.type === 'image' && item.srcId) { console.warn(`Position not defined for ${item.srcId}. Panel not created.`); } }); console.log("Manual image layout generated.");
         }

        // --- Fonction toggleLogoSound (inchangée) ---
        function toggleLogoSound() { /* ... code identique ... */
            const logoPanel = document.getElementById('logo-panel'); const soundButton = document.getElementById('sound-toggle-button'); if (!logoPanel || !logoPanel.components.sound || !soundButton) { console.error("Cannot toggle sound: elements not found."); return; } const soundComponent = logoPanel.components.sound; const sceneEl = document.querySelector('a-scene'); const audioContext = sceneEl?.audioListener?.context; if (audioContext && audioContext.state === 'suspended') { audioContext.resume().catch(e => console.error("Error resuming audio context", e)); } if (soundComponent.isPlaying) { soundComponent.pauseSound(); soundButton.textContent = "Play Sound"; } else { soundComponent.playSound(); soundButton.textContent = "Pause Sound"; }
         }

        // --- Logique d'initialisation (MODIFIÉE pour clic sur bouton info et pop-up) ---
        const sceneEl = document.querySelector('a-scene');

        // Layout (inchangé)
        if (sceneEl.hasLoaded) { setupManualLayout(); }
        else { sceneEl.addEventListener('loaded', setupManualLayout); }

        // Cacher loader, activer bouton son ET activer clics sur bouton info/pop-up
        sceneEl.addEventListener('loaded', () => {
            console.log("A-Frame scene loaded event fired.");

            // Cacher loader (inchangé)
            const loader = document.getElementById('arjs-loader-div');
            if (loader) { setTimeout(() => { loader.style.display = 'none'; }, 500); }
            else { console.warn("Could not find loader element."); }

            // Activer bouton Son (inchangé)
            const soundButton = document.getElementById('sound-toggle-button');
            if (soundButton) {
                setTimeout(() => {
                     if (document.getElementById('logo-panel')) {
                         soundButton.style.display = 'block';
                         soundButton.addEventListener('click', toggleLogoSound);
                         console.log("Sound button activated.");
                     } else { console.error("Logo panel not found. Sound button not activated."); }
                }, 100);
            } else { console.warn("Could not find sound toggle button."); }

            // --- NOUVEAU : Activer le clic sur le bouton Info pour afficher le pop-up ---
            const infoButton = document.getElementById('logo-info-button');
            const popup = document.getElementById('popup-text');

            if (infoButton && popup) {
                 infoButton.addEventListener('click', () => {
                     console.log("Logo info button clicked!");
                     popup.textContent = "bonjour ceci est un test"; // Définit le texte
                     popup.style.display = 'block'; // Affiche la div pop-up
                 });
                 console.log("Added click listener to info button.");
            } else {
                if (!infoButton) console.error("Info button element not found on scene load.");
                if (!popup) console.error("Popup text element not found on scene load.");
            }

            // --- NOUVEAU : Activer le clic sur le pop-up pour le cacher ---
            if (popup) {
                popup.addEventListener('click', () => {
                    console.log("Popup text clicked, hiding it.");
                    popup.style.display = 'none'; // Cache la div pop-up
                });
                 console.log("Added click listener to popup text to hide it.");
            }
            // (Note : le listener pour cacher le pop-up était déjà dans votre code précédent, on le garde ici)
            // --- Fin activation clics info/pop-up ---
        });

    </script>

</body>
</html>
