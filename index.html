<!DOCTYPE html>
<html lang="en">
<head>
    <title>AURALIS AR Experience (A-Frame Markerless)</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="AURALIS AR Experience using A-Frame and AR.js Markerless Tracking.">

    <!-- A-Frame Core -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>

    <!-- AR.js for A-Frame -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.0/aframe/build/aframe-ar.min.js"></script>

    <style>
        body { margin: 0; overflow: hidden; }
        .arjs-loader { height: 100%; width: 100%; position: absolute; top: 0; left: 0; background-color: rgba(0, 0, 0, 0.8); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .arjs-loader div { text-align: center; font-size: 1.25em; color: white; }
        #wechat-notice { position: absolute; top: 10px; left: 10px; right: 10px; padding: 10px; background: rgba(0,0,0,0.7); color: white; z-index: 101; font-size: 14px; text-align: center; border-radius: 5px; }
    </style>
</head>

<body>

    <!-- Message pour WeChat -->
    <div id="wechat-notice" onclick="this.style.display='none';">
        <b>Note WeChat:</b> Pour l'expérience AR, cliquez sur '...' puis 'Ouvrir dans le navigateur'.
    </div>

    <!-- Écran de chargement AR.js -->
    <div class="arjs-loader" id="arjs-loader-div">
        <div>Loading AR Experience...</div>
    </div>

    <!-- Scène A-Frame AR -->
    <a-scene
        embedded
        arjs="sourceType: webcam; trackingMethod: best; debugUIEnabled: false;"
        renderer="logarithmicDepthBuffer: true; colorManagement: true;"
        vr-mode-ui="enabled: false">

        <!-- Assets -->
        <a-assets timeout="60000">
            < img id="logoImg" src="images/logo.jpg" crossorigin="anonymous">
            < img id="wangMengImg" src="images/wang_meng.jpg" crossorigin="anonymous">
            < img id="yuMiaoImg" src="images/yu_miao.jpg" crossorigin="anonymous">
            < img id="djBackImg" src="images/dj_back.jpg" crossorigin="anonymous">
            < img id="stageWideImg" src="images/stage_wide.jpg" crossorigin="anonymous">
            < img id="stageDuoBlueImg" src="images/stage_duo_blue.jpg" crossorigin="anonymous">
            < img id="stageDuoDarkImg" src="images/stage_duo_dark.jpg" crossorigin="anonymous">
        </a-assets>

        <!-- Conteneur pour les panneaux -->
        <a-entity id="content-stack" position="0 1.5 -2" rotation="0 0 0" scale="0.8 0.8 0.8"></a-entity>

        <!-- Caméra -->
        <a-camera cursor="rayOrigin: mouse; fuse: false;" raycaster="objects: [data-interactive]"></a-camera>

    </a-scene>

    <script>
        // --- Configuration ---
        const PANEL_BASE_WIDTH = 1.6;
        const PANEL_TEXT_HEIGHT = 0.35;
        const PANEL_SPACING = 0.05;
        const TEXT_BASE_WIDTH = 5.5;
        const PANEL_COLOR = '#1a1a3a';
        const PANEL_OPACITY = 0.85;
        const TEXT_Z_OFFSET = 0.015;

        // --- Données du contenu ---
        const contentData = [
            { type: 'title', text: "AURALIS" },
            { type: 'image', srcId: 'logoImg', originalWidth: 2, originalHeight: 2 },
            { type: 'text', text: "Step Into Sound and Light:\nA Journey Beyond Music." },
            { type: 'text', text: "Imagine a space where sound moves like liquid...\nWelcome to AURALIS!" },
            { type: 'header', text: "The Architects" },
            { type: 'text', text: "Wang Meng & Yu Miao dissolve boundaries..." },
            { type: 'image', srcId: 'wangMengImg', originalWidth: 1, originalHeight: 1.2 },
            { type: 'text', text: "• Wang Meng: Visionary audio-visual artist..." },
            { type: 'image', srcId: 'yuMiaoImg', originalWidth: 1.5, originalHeight: 1 },
            { type: 'text', text: "• Yu Miao: Guzheng virtuoso pushing limits..." },
            { type: 'header', text: "Sound & Light" },
            { type: 'image', srcId: 'stageWideImg', originalWidth: 2, originalHeight: 1.1 },
            { type: 'text', text: "Dazzling visuals extend the sonic experience..." },
            { type: 'image', srcId: 'djBackImg', originalWidth: 1.8, originalHeight: 1 },
            { type: 'text', text: "Manels Favre shapes 3D sound with SPAT..." },
            { type: 'header', text: "Immersive Music" },
            { type: 'image', srcId: 'stageDuoBlueImg', originalWidth: 1.8, originalHeight: 1.1 },
            { type: 'text', text: "Feel the music flow through you..." },
            { type: 'image', srcId: 'stageDuoDarkImg', originalWidth: 1.8, originalHeight: 1.1 },
            { type: 'cta', text: "Step inside.\nLet yourself be carried away.\n\nComing soon!" }
        ];

        // --- Fonction pour générer les éléments dynamiquement ---
        function setupContentStack() {
            const stack = document.getElementById('content-stack');
            if (!stack) return console.error("Could not find #content-stack entity.");

            let currentY = 0;
            contentData.forEach((item) => {
                const entity = document.createElement('a-entity');
                let panelHeight = PANEL_TEXT_HEIGHT;
                let actualHeight = 0;

                if (item.type === 'image' && item.srcId) {
                    panelHeight = PANEL_BASE_WIDTH / (item.originalWidth / item.originalHeight);
                    const imgPlane = document.createElement('a-plane');
                    imgPlane.setAttribute('width', PANEL_BASE_WIDTH);
                    imgPlane.setAttribute('height', panelHeight);
                    imgPlane.setAttribute('material', `src: #${item.srcId}; shader: flat; transparent: true;`);
                    entity.appendChild(imgPlane);
                    actualHeight = panelHeight;
                } else if (item.text) {
                    const textEntity = document.createElement('a-text');
                    textEntity.setAttribute('value', item.text);
                    textEntity.setAttribute('color', '#FFF');
                    textEntity.setAttribute('align', 'center');
                    textEntity.setAttribute('width', TEXT_BASE_WIDTH);
                    textEntity.setAttribute('position', `0 0 ${TEXT_Z_OFFSET}`);
                    entity.appendChild(textEntity);
                    actualHeight = PANEL_TEXT_HEIGHT;
                }

                if (actualHeight > 0) {
                    entity.setAttribute('position', `0 ${currentY - actualHeight / 2} 0`);
                    stack.appendChild(entity);
                    currentY -= (actualHeight + PANEL_SPACING);
                }
            });
        }

        document.querySelector('a-scene').addEventListener('loaded', setupContentStack);
    </script>

</body>
</html>
