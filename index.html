<!DOCTYPE html>
<html>
<head>
    <title>AURALIS AR Experience (Manual Image Layout)</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="AURALIS AR Experience using A-Frame and AR.js with manually defined image layout.">

    <!-- A-Frame Core -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>

    <!-- AR.js for A-Frame -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.0/aframe/build/aframe-ar.min.js"></script>

    <style> 

        
        #progress-container {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 80%;
    height: 20px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    overflow: hidden;
    display: none;
    z-index: 1000;
}

#progress-bar {
    width: 0%;
    height: 100%;
    background: #4caf50;
    transition: width 0.2s ease-in-out;
}
        
        body { margin: 0; overflow: hidden; }
        .arjs-loader { height: 100%; width: 100%; position: absolute; top: 0; left: 0; background-color: rgba(0, 0, 0, 0.8); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .arjs-loader div { text-align: center; font-size: 1.25em; color: white; }
        #wechat-notice { position: absolute; top: 10px; left: 10px; right: 10px; padding: 10px; background: rgba(0,0,0,0.7); color: white; z-index: 101; font-size: 14px; text-align: center; border-radius: 5px; }
    </style>
</head>

<body style='margin : 0px; overflow: hidden;'>

    <!-- --- Message pour WeChat --- -->
    <div id="wechat-notice" onclick="this.style.display='none';">
        <b>Note WeChat:</b> Pour l'expérience AR, cliquez sur '...' puis 'Ouvrir dans le navigateur'.
    </div>

    <!-- --- Écran de chargement AR.js --- -->
    <div class="arjs-loader" id="arjs-loader-div">
        <div>Loading AURALIS Experience...</div>
    </div>

     
    <a-scene
        id="ar-scene"
        embedded
        arjs='sourceType: webcam; trackingMethod: best; debugUIEnabled: false;'
        renderer='logarithmicDepthBuffer: true; colorManagement: true;'
        vr-mode-ui='enabled: false'>

        <!-- --- Assets --- -->
        <a-assets timeout="60000">
             <img id="logoImg" src="images/logo.jpg" crossOrigin="anonymous">
             <img id="wangMengImg" src="images/wang_meng.jpg" crossOrigin="anonymous">
             <img id="yuMiaoImg" src="images/yu_miao.jpg" crossOrigin="anonymous">
             <img id="djBackImg" src="images/dj_back.jpg" crossOrigin="anonymous">
             <img id="stageWideImg" src="images/stage_wide.jpg" crossOrigin="anonymous">
             <img id="stageDuoBlueImg" src="images/stage_duo_blue.jpg" crossOrigin="anonymous">
             <img id="stageDuoDarkImg" src="images/stage_duo_dark.jpg" crossOrigin="anonymous">
        

        <!-- NOUVEAU : Audio Asset -->
              <!-- Remplacez "audio/your_sound.mp3" par le chemin réel vers votre fichier son -->
             <audio id="logoSound" src="audio/your_sound.mp3" preload="auto" crossOrigin="anonymous"></audio>


            <!-- NOUVEAU : Modèle 3D -->
              <!-- Remplacez "models/meduse.glb" par le chemin réel vers votre modèle -->
             <a-asset-item id="jellyfishModel" src="models/meduse.glb" crossOrigin="anonymous"></a-asset-item>
            
        </a-assets>

        <!-- --- Conteneur pour les panneaux (Ancre globale) --- -->
       <!-- Positionné un peu plus loin, scale à 1 car les positions sont absolues dans ce conteneur -->
        <a-entity id="content-container" position="0 1.5 -4.0" rotation="0 0 0" scale="1 1 1">
            <!-- Les panneaux image seront ajoutés ici selon les positions définies en JS -->
        </a-entity>



        <!-- NOUVEAU : Méduse 3D Animée -->
        <a-gltf-model id="jellyfish"
                      src="#jellyfishModel"
                      position="-1 2 -2"           
                      scale="0.3 0.3 0.3"         
                      rotation="0 0 0"            

                   
                      animation__pos="property: position;
                                    from: -1 2 -2;       
                                    to: 1 1.2 -1.5;      
                                    dir: alternate;      
                                    dur: 12000;          
                                    easing: easeInOutSine;  
                                    loop: true;"         

                      
                      animation__rot="property: rotation;
                                    to: 0 360 0;        
                                    dur: 20000;          
                                    easing: linear;      
                                    loop: true;"

                      
                      animation-mixer="clip: *; loop: repeat"
                      >
        </a-gltf-model>
        

        <!-- --- Caméra --- -->
        <a-camera cursor="rayOrigin: mouse; fuse: false;" raycaster="objects: [data-interactive]"></a-camera>

    </a-scene>

    <!-- --- Script pour générer le contenu --- -->
    <script>
        // --- Configuration ---
        const PANEL_BASE_WIDTH = 1.8;   // Largeur standard panneau image
        const PANEL_COLOR = '#1a1a3a';
        const PANEL_OPACITY = 0.85;
        const BG_Z_OFFSET = -0.01;      // Décalage Z du fond
        const IMAGE_Z_OFFSET = 0;       // Position Z de l'image

        // **********************************************************
        // --- MODIFIEZ ICI : Positions manuelles pour chaque image ---
        //     Les coordonnées x, y, z sont relatives au centre du
        //     conteneur #content-container (qui est lui-même placé
        //     devant la caméra).
        //     x positif = droite, y positif = haut, z positif = vers vous
        // **********************************************************
        const imagePositions = {
            // Logo au centre, légèrement en avant
            'logoImg':         { x: 0,    y: 0,    z: 0.1 },

            // Exemples de placement (à ajuster selon vos préférences)
            'wangMengImg':     { x: -2.2, y: 2,  z: -0.1 }, // Gauche, un peu haut, un peu derrière
            'yuMiaoImg':       { x: 2.2,  y: 0.4,  z: -0.1 }, // Droite, un peu haut, un peu derrière
            'stageWideImg':    { x: 0,    y: 2,  z: -0.3 }, // Au dessus du logo, plus loin derrière
            'djBackImg':       { x: 0,    y: -2, z: -0.2 }, // En dessous du logo, derrière
            'stageDuoBlueImg': { x: -2.5, y: -0.8, z: 0.2 },  // En bas à gauche, en avant
            'stageDuoDarkImg': { x: 2.5,  y: -0.8, z: 0.2 },  // En bas à droite, en avant

            // Ajoutez/modifiez des entrées pour correspondre aux srcId de vos images
        };
        // **********************************************************

        // --- Données du contenu (Seules les images seront utilisées) ---
        const contentData = [ { type: 'image', srcId: 'logoImg', originalWidth: 2, originalHeight: 2 }, 
                             { type: 'image', srcId: 'wangMengImg', originalWidth: 1, originalHeight: 1.2 }, 
                             { type: 'image', srcId: 'yuMiaoImg', originalWidth: 1.5, originalHeight: 1 }, 
                             { type: 'image', srcId: 'stageWideImg', originalWidth: 2, originalHeight: 1.1 }, 
                             { type: 'image', srcId: 'djBackImg', originalWidth: 1, originalHeight: 1.25 }, 
                             { type: 'image', srcId: 'stageDuoBlueImg', originalWidth: 1.8, originalHeight: 1.1 }, 
                             { type: 'image', srcId: 'stageDuoDarkImg', originalWidth: 1.8, originalHeight: 1.1 } ];


        // --- Fonction createPanel (Uniquement pour images) ---
        function createImagePanel(itemData, position) {
            const container = document.getElementById('content-container');
            if (!container || !itemData || itemData.type !== 'image' || !itemData.srcId) return null;
            const imgElement = document.getElementById(itemData.srcId);
            if (!imgElement || !itemData.originalWidth || !itemData.originalHeight) { console.warn(`Asset/dimensions missing for ${itemData.srcId}`); return null; }

            const entity = document.createElement('a-entity');
            const aspect = itemData.originalWidth / itemData.originalHeight;
            const panelWidth = PANEL_BASE_WIDTH; const panelHeight = panelWidth / aspect;

            

            // Interaction
            entity.setAttribute('animation__scaleup', `property: scale; to: 1.1 1.1 1.1; startEvents: mouseenter; dur: 200; easing: easeOutQuad;`);
            entity.setAttribute('animation__scaledown', `property: scale; to: 1 1 1; startEvents: mouseleave; dur: 200; easing: easeInQuad;`);
            entity.setAttribute('data-interactive', '');

            // Fond
            const imgBgPlane = document.createElement('a-plane'); imgBgPlane.setAttribute('width', panelWidth * 1.05); imgBgPlane.setAttribute('height', panelHeight * 1.05); imgBgPlane.setAttribute('material', `color: ${PANEL_COLOR}; opacity: ${PANEL_OPACITY}; shader: flat;`); imgBgPlane.setAttribute('position', `0 0 ${BG_Z_OFFSET - 0.005}`); entity.appendChild(imgBgPlane);
            // Image
            const imgPlane = document.createElement('a-plane'); imgPlane.setAttribute('width', panelWidth); imgPlane.setAttribute('height', panelHeight); imgPlane.setAttribute('material', `src: #${itemData.srcId}; shader: flat; transparent: true;`); imgPlane.setAttribute('position', `0 0 ${IMAGE_Z_OFFSET}`); entity.appendChild(imgPlane);



            // *** NOUVEAU : Ajouter le composant son SI c'est le logo ***
            if (itemData.srcId === 'logoImg') {
                entity.setAttribute('sound', {
                    src: '#logoSound',          // Référence à l'asset audio préchargé
                    autoplay: true,             // Jouer automatiquement
                    loop: true,                 // Répéter le son
                    volume: 0.8,                // Volume (0 à 1)
                    positional: true,           // TRÈS IMPORTANT: active la spatialisation
                    distanceModel: 'inverse',   // Modèle d'atténuation du son ('linear', 'inverse', 'exponential')
                    refDistance: 1,             // Distance (en mètres A-Frame) où le volume est de 100%
                    rolloffFactor: 1            // À quelle vitesse le son diminue avec la distance
                });
                console.log(`Added positional sound component to logoImg panel.`);
            }
            // *** Fin ajout son ***
            
            
            // Appliquer la position DÉFINIE MANUELLEMENT
            entity.setAttribute('position', `${position.x} ${position.y} ${position.z}`);
            container.appendChild(entity);

            console.log(`Created image panel for ${itemData.srcId} at`, position);
            return entity;
        }

const progressContainer = document.getElementById('progress-container');
const progressBar = document.getElementById('progress-bar');

const assetsToLoad = [
    "logoImg", "wangMengImg", "yuMiaoImg", "djBackImg", "stageWideImg", 
    "stageDuoBlueImg", "stageDuoDarkImg", "jellyfishModel", "logoSound"
];

let loadedAssets = 0;

// Fonction pour mettre à jour la barre de progression
function updateProgress() {
    const percentage = (loadedAssets / assetsToLoad.length) * 100;
    progressBar.style.width = percentage + "%";

    if (percentage >= 100) {
        setTimeout(() => {
            progressContainer.style.display = 'none';
        }, 500);
    }
}

// Afficher la barre au début du chargement

        let element = document.getElementById("id-de-ton-element");
if (element) {
    element.style.display = "none"; // ou une autre action
}
progressContainer.style.display = 'block';

// Vérifier le chargement des images
assetsToLoad.forEach(id => {
    const asset = document.getElementById(id);
    if (asset) {
        if (asset.tagName === 'IMG') {
            asset.onload = () => { loadedAssets++; updateProgress(); };
        } else if (asset.tagName === 'A-ASSET-ITEM' || asset.tagName === 'AUDIO') {
            asset.addEventListener('loaded', () => { loadedAssets++; updateProgress(); });
        }
    }
});

// Vérifier le chargement du modèle 3D
const jellyfishModel = document.getElementById('jellyfish');
if (jellyfishModel) {
    jellyfishModel.addEventListener('model-loaded', () => {
        loadedAssets++;
        updateProgress();
    });
}

        
        // --- Fonction setupManualLayout ---
        function setupManualLayout() {
            const container = document.getElementById('content-container');
            if (!container) { console.error("Could not find #content-container entity."); return; }
            while (container.firstChild) { container.removeChild(container.firstChild); } // Vider

            // Itérer sur les données de contenu (qui ne contiennent que des images maintenant)
            contentData.forEach(item => {
                if (item.type === 'image' && item.srcId && imagePositions[item.srcId]) {
                    // Récupérer la position définie dans l'objet imagePositions
                    const position = imagePositions[item.srcId];
                    // Créer le panneau à cette position
                    createImagePanel(item, position);
                } else if (item.type === 'image' && item.srcId) {
                    console.warn(`Position not defined in imagePositions for ${item.srcId}. Panel not created.`);
                }
                // Ignorer les autres types (texte, etc.)
            });

            console.log("Manual image layout generated.");
        }

        // --- Attendre chargement scène ---
        const sceneEl = document.querySelector('a-scene');
        if (sceneEl.hasLoaded) { setupManualLayout(); } // Appeler la nouvelle fonction
        else { sceneEl.addEventListener('loaded', setupManualLayout); } // Appeler la nouvelle fonction

        // --- Cacher le loader manuellement ---
        sceneEl.addEventListener('loaded', () => {
            console.log("A-Frame scene loaded event fired.");
            const loader = document.getElementById('arjs-loader-div');
            if (loader) { console.log("Hiding AR.js loader."); setTimeout(() => { loader.style.display = 'none'; }, 500); }
            else { console.warn("Could not find loader element to hide."); }
        });

        // --- PAS DE DRAG DANS CETTE VERSION ---

    </script>
    
<div id="progress-container">
    <div id="progress-bar"></div>
</div>
    
</body>
</html>
